<!DOCTYPE HTML>
<html lang="en">
<head>
	<title>Listing 2-1, A First WebGL Example</title>
	<meta charset="utf-8">

	<script id="bundle.vs" type="x-shader/x-vertex">
		#version 300

		precision highp float;
		precision highp int;

		in vec3 vertexPos;			// Posicion de las fibras
		in vec3 vertexNor;			// Normales 
		in int vertexCol;			// Colores

		out vec4 color;

		uniform sampler2D uColorTable;

		uniform mat4 systemScaleM;
		uniform mat4 M;
		uniform mat4 V;
		uniform mat4 P;

		struct LightInfo {
			vec4 pos;				// Posicion de la luz.
			vec3 La;				// Intensidad de luz ambiental.
			vec3 Ld;				// Intensidad de luz difusa.
			vec3 Ls;				// Intensidad de luz especular.
		};
		uniform LightInfo Light;

		struct MaterialInfo {
			float Ka;				// Reflectividad ambiental.
			float Kd;				// Reflectividad difusa.
			float Ks;				// Reflectividad especular.
			float shininess;		// Coeficiente de reflexion especular.
		};
		uniform MaterialInfo Material;

		void main() {
			// Iluminacion.
			vec4 p = V*M*vec4(vertexPos, 1.0);

			vec3 n = normalize(mat3(V*M)*vertexNor);
			vec3 l = normalize(vec3(Light.pos - p));
			vec3 v = normalize(-p.xyz);
			vec3 r = reflect(-l, n);

			vec3 ambi = Light.La*Material.Ka;
			vec3 diff = Light.Ld*Material.Kd*max( dot(l, n), 0.0);
			vec3 spec = Light.Ls*Material.Ks*pow(max(dot(r,v), 0.0), Material.shininess);
			
			// Salidas.
			color = vec4(ambi + diff + spec, 1.0) * texelFetch(uColorTable, ivec2(vertexCol, 0), 0);
			gl_Position = P*V*systemScaleM*M*vec4(vertexPos, 1.0);
		}
	</script>

	<script id="standard-fragment" type="x-shader/x-fragment">
		#version 300 es

		precision highp float;

		in vec4 color;

		out vec4 outColor;

		void main() {
			outColor = color;
		}
	</script>	

	<!-- <script type="text/javascript" src="webgl-debug.js"></script> -->

	
	<!-- Classes and utilities -->
	<!-- <script type="text/javascript" src="quaternion.js"></script> -->
	<script type="text/javascript" src="gl-matrix.js"></script>
	<script type="text/javascript" src="spherical-camera.js"></script>
	<script type="text/javascript" src="base-visualization.js"></script>
	<script type="text/javascript" src="bundle.js"></script>

	<script type="text/javascript" src="abrain-utilities.js"></script>
	<script type="text/javascript" src="jquery-3.6.0.js"></script>	<!-- For reading text files, and hopefully binary fiies -->

	<script type="text/javascript" src="webgl_triangle.js"></script>
</head>

<body onload="startup();">
	<canvas id="myGLCanvas" width="500" height="500"></canvas>

	<input type="file" id="avatar" name="avatar" accept="bundles/bundles, TRK/trk, TCK/tck">
</body>

</html>